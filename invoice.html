<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GST Invoice</title>
    <!-- Tailwind CSS CDN for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .invoice-container {
            max-width: 800px;
            margin: 2rem auto;
            background: #fff;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        input, textarea, [contenteditable] {
            outline: none;
            border-bottom: 1px dashed #d1d5db;
            background: transparent;
            padding: 0;
            cursor: pointer;
        }
        input:focus, textarea:focus, [contenteditable]:focus {
            border-bottom: 1px solid #1e40af;
        }
        @media print {
            .no-print {
                display: none !important;
            }
            .invoice-container {
                box-shadow: none;
                margin: 0;
                padding: 0;
            }
            input, textarea, [contenteditable] {
                border-bottom: none !important;
                background: none !important;
            }
            body {
                background: #fff;
                /* Reduce font size for printing to fit more content on one page */
                font-size: 0.75rem;
            }
            .page-break {
                page-break-after: always;
            }
            /* Add a class to avoid breaking inside sections */
            .page-break-avoid {
                page-break-inside: avoid;
            }
            /* Hide the roundoff row on print unless the checkbox is checked */
            .print-hide-roundoff {
                display: none !important;
            }
            /* Make text smaller on print to fit more on the page */
            p, span, td, th {
                font-size: 0.75rem;
            }
        }
        .spinner {
            border: 2px solid rgba(0, 0, 0, 0.1);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border-left-color: #000;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="invoice-container">
        <!-- Header -->
        <header class="flex flex-col sm:flex-row justify-between items-center mb-10">
            <div class="flex items-center space-x-4">
                <h1 class="text-2xl font-extrabold text-gray-900 tracking-tight">TAX INVOICE</h1>
            </div>
            <div class="text-sm text-right mt-4 sm:mt-0">
                <p>Invoice No: <span id="invoice-no" contenteditable="true" class="font-bold text-blue-700">INV-001</span></p>
                <p>Date: <span id="invoice-date" contenteditable="true" class="font-bold text-blue-700">14/08/2024</span></p>
                <!-- Changed "State" back to "Placeholder" -->
                <p>Placeholder: <input type="text" placeholder="e.g. Haryana" class="font-bold text-blue-700 text-right"></p>
            </div>
        </header>

        <!-- Seller & Buyer Details -->
        <!-- Reduced gap from gap-4 to gap-2 for even more compact spacing -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 mb-8">
            <!-- Seller Details (Supplier) -->
            <div>
                <h2 class="text-lg font-bold text-gray-700 mb-2">Seller (Supplier Details)</h2>
                <!-- Reduced padding from p-3 to p-2 -->
                <div class="border rounded-lg p-2 bg-gray-50 text-sm">
                    <p class="font-bold text-lg mb-1" id="business-name" contenteditable="true">Your Business Name</p>
                    <p>GSTIN: <span contenteditable="true" class="text-gray-600">27AASCA2490A1Z1</span></p>
                    <p>Address: <span contenteditable="true" class="text-gray-600">123 Business Lane, City, State - 110001</span></p>
                    <p>Phone: <span contenteditable="true" class="text-gray-600">+91 9876543210</span></p>
                    <p>Email: <span contenteditable="true" class="text-gray-600">info@yourbusiness.com</span></p>
                </div>
            </div>
            <!-- Buyer Details (Receiver) -->
            <div>
                <h2 class="text-lg font-bold text-gray-700 mb-2">Buyer (Receiver Details)</h2>
                <!-- Reduced padding from p-3 to p-2 -->
                <div class="border rounded-lg p-2 bg-gray-50 text-sm">
                    <p class="font-bold text-lg mb-1" contenteditable="true">Client Business Name</p>
                    <p>GSTIN: <span contenteditable="true" class="text-gray-600">07AAACR1234F1Z9</span></p>
                    <p>Address: <span contenteditable="true" class="text-gray-600">456 Client Street, City, State - 201301</span></p>
                    <p>Phone: <span contenteditable="true" class="text-gray-600">+91 9988776655</span></p>
                    <p>Email: <span contenteditable="true" class="text-gray-600">client@example.com</span></p>
                </div>
            </div>
        </div>

        <!-- Items Table -->
        <div class="mb-2">
            <table class="min-w-full text-left border-collapse table-auto">
                <thead>
                    <tr class="bg-gray-100 text-gray-600 text-xs font-semibold uppercase tracking-wider">
                        <th class="p-2 border-b-2 w-10">S. No.</th>
                        <!-- Increased width of Item Description column by making others narrower -->
                        <th class="p-2 border-b-2">Item Description</th>
                        <th class="p-2 border-b-2 text-center w-20">HSN/SAC</th>
                        <th class="p-2 border-b-2 text-right w-12">Qty</th>
                        <th class="p-2 border-b-2 text-right w-20">Rate (₹)</th>
                        <th class="p-2 border-b-2 text-right w-24">Taxable Value (₹)</th>
                        <th class="p-2 border-b-2 text-right w-12">CGST (%)</th>
                        <th class="p-2 border-b-2 text-right w-12">SGST (%)</th>
                        <th class="p-2 border-b-2 text-right w-12">IGST (%)</th>
                        <th class="p-2 border-b-2 text-right w-12">Cess (%)</th>
                        <th class="p-2 border-b-2 text-right w-24">Total (₹)</th>
                        <th class="p-2 border-b-2 no-print w-12"></th>
                    </tr>
                </thead>
                <tbody id="invoice-items-container">
                    <!-- Dynamic rows will be added here -->
                </tbody>
            </table>
        </div>

        <div class="no-print mb-8">
            <button id="add-item-btn" class="bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg shadow hover:bg-blue-700 transition-colors">Add Item</button>
        </div>

        <!-- Totals & Summary -->
        <!-- Reduced mb-4 to mb-2 to make this section smaller -->
        <div class="flex justify-end mb-2">
            <div class="w-full sm:w-1/2">
                <!-- Reduced py-0.5 to py-0 to make it even more compact -->
                <div class="flex justify-between text-sm py-0">
                    <span class="text-gray-600">Subtotal:</span>
                    <span id="subtotal-amount" class="font-bold">₹ 0.00</span>
                </div>
                <div class="flex justify-between text-sm py-0">
                    <span class="text-gray-600">Total CGST:</span>
                    <span id="total-cgst-amount" class="font-bold">₹ 0.00</span>
                </div>
                <div class="flex justify-between text-sm py-0">
                    <span class="text-gray-600">Total SGST:</span>
                    <span id="total-sgst-amount" class="font-bold">₹ 0.00</span>
                </div>
                <div class="flex justify-between text-sm py-0">
                    <span class="text-gray-600">Total IGST:</span>
                    <span id="total-igst-amount" class="font-bold">₹ 0.00</span>
                </div>
                <div class="flex justify-between text-sm py-0">
                    <span class="text-gray-600">Total Cess:</span>
                    <span id="total-cess-amount" class="font-bold">₹ 0.00</span>
                </div>
                <!-- Reduced mt-1 pt-1 to mt-0.5 pt-0.5 -->
                <div id="roundoff-row" class="flex justify-between text-sm py-0 border-t border-dashed mt-0.5 pt-0.5 items-center">
                    <label class="text-gray-600 flex items-center">
                        Round Off
                        <input type="checkbox" id="roundoff-checkbox" class="ml-2">
                    </label>
                    <span id="roundoff-amount" class="font-bold">₹ 0.00</span>
                </div>
                <!-- Reduced mt-2 pt-2 to mt-1 pt-1 -->
                <div class="flex justify-between font-bold text-xl mt-1 pt-1 border-t-2 border-gray-400">
                    <span>Grand Total:</span>
                    <span id="grand-total-amount" class="text-blue-800">₹ 0.00</span>
                </div>
            </div>
        </div>

        <!-- Amount in Words -->
        <div class="mb-8">
            <p class="text-sm">Amount in Words: <span id="amount-in-words" class="font-bold italic">Rupees Zero Only</span></p>
        </div>

        <!-- Bank Details & Declaration -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-8 mb-10">
            <!-- New container to keep heading with content on print -->
            <div class="page-break-avoid">
                <h3 class="text-lg font-bold text-gray-700 mb-2">Bank Details</h3>
                <div class="border rounded-lg p-4 bg-gray-50 text-sm">
                    <p>Bank Name: <span contenteditable="true">Your Bank Name</span></p>
                    <p>Account No: <span contenteditable="true">1234567890</span></p>
                    <p>IFSC Code: <span contenteditable="true">ABCD0001234</span></p>
                </div>
            </div>
            <!-- New container to keep heading with content on print -->
            <div class="page-break-avoid">
                <h3 class="text-lg font-bold text-gray-700 mb-2">Declaration</h3>
                <div class="border rounded-lg p-4 bg-gray-50 text-sm italic text-gray-600">
                    <p contenteditable="true">We declare that this invoice shows the total amount of tax and that we have complied with the provisions of the GST Act, 2017. This is a computer generated invoice and no signature is required.</p>
                </div>
            </div>
        </div>

        <!-- Signature Section -->
        <div class="flex justify-end mt-10">
            <div class="text-right">
                <p class="font-bold mb-4">For <span contenteditable="true" class="text-blue-800">[Your Business Name]</span></p>
                <div class="w-40 h-20 border-b-2 border-gray-400 mb-2"></div>
                <p class="text-sm text-gray-500">Authorized Signatory</p>
            </div>
        </div>

        <!-- Print Button (non-printable) -->
        <div class="flex justify-center mt-10 no-print">
            <button onclick="window.print()" class="bg-blue-600 text-white font-semibold py-3 px-8 rounded-lg shadow-lg hover:bg-blue-700 transition-colors">Generate PDF / Print</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const invoiceItemsContainer = document.getElementById('invoice-items-container');
            const addItemBtn = document.getElementById('add-item-btn');
            const subtotalAmountSpan = document.getElementById('subtotal-amount');
            const totalCgstAmountSpan = document.getElementById('total-cgst-amount');
            const totalSgstAmountSpan = document.getElementById('total-sgst-amount');
            const totalIgstAmountSpan = document.getElementById('total-igst-amount');
            const totalCessAmountSpan = document.getElementById('total-cess-amount');
            const grandTotalAmountSpan = document.getElementById('grand-total-amount');
            const amountInWordsSpan = document.getElementById('amount-in-words');
            const roundoffCheckbox = document.getElementById('roundoff-checkbox');
            const roundoffAmountSpan = document.getElementById('roundoff-amount');
            const roundoffRow = document.getElementById('roundoff-row');
            
            function toWords(num) {
                const a = ['', 'one ', 'two ', 'three ', 'four ', 'five ', 'six ', 'seven ', 'eight ', 'nine ', 'ten ', 'eleven ', 'twelve ', 'thirteen ', 'fourteen ', 'fifteen ', 'sixteen ', 'seventeen ', 'eighteen ', 'nineteen '];
                const b = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];
                const regex = /^(\d{2})(\d{2})(\d{2})(\d{1})(\d{2})$/;

                function inRs(n) {
                    if ((n = n.toString()).length > 9) return 'overflow';
                    let n2 = ('000000000' + n).substr(-9).match(regex);
                    if (!n2) return 'invalid number';
                    let str = '';
                    str += (n2[1] != 0) ? (a[Number(n2[1])] || b[n2[1][0]] + ' ' + a[n2[1][1]]) + 'crore ' : '';
                    str += (n2[2] != 0) ? (a[Number(n2[2])] || b[n2[2][0]] + ' ' + a[n2[2][1]]) + 'lakh ' : '';
                    str += (n2[3] != 0) ? (a[Number(n2[3])] || b[n2[3][0]] + ' ' + a[n2[3][1]]) + 'thousand ' : '';
                    str += (n2[4] != 0) ? (a[Number(n2[4])] || b[n2[4][0]] + ' ' + a[n2[4][1]]) + 'hundred ' : '';
                    str += (n2[5] != 0) ? ((str != '') ? 'and ' : '') + (a[Number(n2[5])] || b[n2[5][0]] + ' ' + a[n2[5][1]]) : '';
                    return str;
                }

                let wholePart = Math.floor(num);
                let decimalPart = Math.round((num - wholePart) * 100);
                
                let wholeWords = inRs(wholePart);
                let decimalWords = inRs(decimalPart);

                let result = '';
                if (wholePart > 0) {
                    result += 'Rupees ' + wholeWords.trim() + ' ';
                }
                if (decimalPart > 0) {
                    result += 'and ' + decimalWords.trim() + 'Paise';
                }
                
                return result.trim() + ' Only';
            }

            function updateAllTotals() {
                let subtotal = 0;
                let totalCgst = 0;
                let totalSgst = 0;
                let totalIgst = 0;
                let totalCess = 0;
                
                document.querySelectorAll('#invoice-items-container tr').forEach(row => {
                    const taxableValue = parseFloat(row.querySelector('[data-taxable-value]').textContent) || 0;
                    
                    const cgstRate = parseFloat(row.querySelector('[data-cgst-input]').value) || 0;
                    const sgstRate = parseFloat(row.querySelector('[data-sgst-input]').value) || 0;
                    const igstRate = parseFloat(row.querySelector('[data-igst-input]').value) || 0;
                    const cessRate = parseFloat(row.querySelector('[data-cess-input]').value) || 0;

                    const cgst = (taxableValue * cgstRate) / 100;
                    const sgst = (taxableValue * sgstRate) / 100;
                    const igst = (taxableValue * igstRate) / 100;
                    const cess = (taxableValue * cessRate) / 100;

                    subtotal += taxableValue;
                    totalCgst += cgst;
                    totalSgst += sgst;
                    totalIgst += igst;
                    totalCess += cess;
                });

                const rawGrandTotal = subtotal + totalCgst + totalSgst + totalIgst + totalCess;
                let roundoff = 0;

                // Toggle a class for print visibility based on checkbox state
                if (roundoffCheckbox.checked) {
                    roundoffRow.classList.remove('print-hide-roundoff');
                    const roundedTotal = Math.round(rawGrandTotal);
                    roundoff = roundedTotal - rawGrandTotal;
                } else {
                    roundoffRow.classList.add('print-hide-roundoff');
                }
                
                const grandTotal = rawGrandTotal + roundoff;

                subtotalAmountSpan.textContent = `₹ ${grandTotal.toFixed(2)}`;
                totalCgstAmountSpan.textContent = `₹ ${totalCgst.toFixed(2)}`;
                totalSgstAmountSpan.textContent = `₹ ${totalSgst.toFixed(2)}`;
                totalIgstAmountSpan.textContent = `₹ ${totalIgst.toFixed(2)}`;
                totalCessAmountSpan.textContent = `₹ ${totalCess.toFixed(2)}`;
                roundoffAmountSpan.textContent = `₹ ${roundoff.toFixed(2)}`;
                grandTotalAmountSpan.textContent = `₹ ${grandTotal.toFixed(2)}`;
                amountInWordsSpan.textContent = toWords(grandTotal);
            }

            function addItem(isInitial = false) {
                const newRow = document.createElement('tr');
                newRow.className = "border-b text-sm";
                newRow.innerHTML = `
                    <td class="p-2">
                        <span class="serial-no">${invoiceItemsContainer.children.length + 1}</span>
                    </td>
                    <td class="p-2">
                        <span contenteditable="true">Item Description</span>
                    </td>
                    <td class="p-2 text-center">
                        <span contenteditable="true">HSN/SAC</span>
                    </td>
                    <td class="p-2 text-right">
                        <!-- Reduced width from w-12 to w-10 -->
                        <input type="number" value="1" min="1" class="qty w-10 text-right">
                    </td>
                    <td class="p-2 text-right">
                        <!-- Reduced width from w-20 to w-16 -->
                        <input type="number" value="0.00" min="0" step="0.01" class="rate w-16 text-right">
                    </td>
                    <td class="p-2 text-right">
                        <span data-taxable-value>0.00</span>
                    </td>
                    <td class="p-2 text-right">
                        <!-- Reduced width from w-12 to w-10 -->
                        <input type="number" value="0.00" step="0.01" class="w-10 text-right" data-cgst-input>
                    </td>
                    <td class="p-2 text-right">
                        <!-- Reduced width from w-12 to w-10 -->
                        <input type="number" value="0.00" step="0.01" class="w-10 text-right" data-sgst-input>
                    </td>
                    <td class="p-2 text-right">
                        <!-- Reduced width from w-12 to w-10 -->
                        <input type="number" value="0.00" step="0.01" class="w-10 text-right" data-igst-input>
                    </td>
                    <td class="p-2 text-right">
                        <!-- Reduced width from w-12 to w-10 -->
                        <input type="number" value="0.00" step="0.01" class="w-10 text-right" data-cess-input>
                    </td>
                    <td class="p-2 text-right font-semibold">
                        <span data-total-value>0.00</span>
                    </td>
                    <td class="p-2 text-center no-print">
                        <button class="remove-item-btn text-red-500 hover:text-red-700 transition-colors">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd"></path></svg>
                        </button>
                    </td>
                `;
                
                invoiceItemsContainer.appendChild(newRow);

                const qtyInput = newRow.querySelector('.qty');
                const rateInput = newRow.querySelector('.rate');
                const cgstInput = newRow.querySelector('[data-cgst-input]');
                const sgstInput = newRow.querySelector('[data-sgst-input]');
                const igstInput = newRow.querySelector('[data-igst-input]');
                const cessInput = newRow.querySelector('[data-cess-input]');
                const removeBtn = newRow.querySelector('.remove-item-btn');

                const updateRow = () => {
                    const qty = parseFloat(qtyInput.value) || 0;
                    const rate = parseFloat(rateInput.value) || 0;
                    const cgstRate = parseFloat(cgstInput.value) || 0;
                    const sgstRate = parseFloat(sgstInput.value) || 0;
                    const igstRate = parseFloat(igstInput.value) || 0;
                    const cessRate = parseFloat(cessInput.value) || 0;

                    const taxableValue = qty * rate;
                    const totalTax = (taxableValue * (cgstRate + sgstRate + igstRate + cessRate)) / 100;
                    
                    newRow.querySelector('[data-taxable-value]').textContent = taxableValue.toFixed(2);
                    newRow.querySelector('[data-total-value]').textContent = (taxableValue + totalTax).toFixed(2);

                    updateAllTotals();
                };

                qtyInput.addEventListener('input', updateRow);
                rateInput.addEventListener('input', updateRow);
                cgstInput.addEventListener('input', updateRow);
                sgstInput.addEventListener('input', updateRow);
                igstInput.addEventListener('input', updateRow);
                cessInput.addEventListener('input', updateRow);

                removeBtn.addEventListener('click', () => {
                    newRow.remove();
                    updateAllTotals();
                    document.querySelectorAll('.serial-no').forEach((el, index) => {
                        el.textContent = index + 1;
                    });
                });

                updateRow();

                if (!isInitial) {
                    qtyInput.focus();
                }
            }

            addItem(true);
            addItemBtn.addEventListener('click', () => addItem(false));
            roundoffCheckbox.addEventListener('change', updateAllTotals);
            updateAllTotals(); // Initial call to set print visibility
        });
    </script>
</body>
</html>
